{%extends 'home.html'%}
{% load static %}
{%block content%}
    <div class="container">

        <div class="card- o-hidden border-0 shadow-lg- my-5-">
            <div class="card-body p-0">
                <!-- Nested Row within Card Body -->
                <div class="row">
                    <div class="col-lg-12">
                         <div>
                                <h4>Add Vacation</h4>
                            </div>
                        {% if page is True %}
                        <form class="user" method="POST"  id="update-vacation">
                            {% csrf_token%}

                            <div  class="row">
                                <div  class="form__field col-md-3 mb-2">
                                <select name="type_vacation" id="type_vacation" class="form-control" >
                                {% for x,y in types%}
                                    <option value="{{x}}"
                                        {% if vacation.type_vacation == x %}
                                            selected="selected"
                                        {% endif %}>
                                        {{y}}
                                    </option>
                                {%endfor %}
                                </select>
                             </div>

                             
                             <div class="form__field col-md-3 mb-2">
                                <div class="form-group">
                                    <div class="input-group date">
                                        <input id="start_date"
                                        placeholder="Start Date" 
                                        type="text"
                                        class="form-control"
                                        value={{vacation.start_date|date:"Y-m-d"}}>
                                        <div class="input-group-addon input-group-prepend">
                                            <span class="input-group-text"><i class="fas fa-calendar"></i></span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="form__field col-md-3 mb-2">
                            <div class="form-group">
                                <div class="input-group date">
                                    <input id ="end_date"
                                     placeholder="End Date"
                                      type="text" 
                                      class="form-control"
                                      value={{vacation.end_date|date:"Y-m-d"}}>
                                    <div class="input-group-addon input-group-prepend">
                                        <span class="input-group-text"><i class="fas fa-calendar"></i></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form__field col-md-3 mb-2 text-center">
                            <div class="form-group">
                                <div class="input-group date">
                                    <p id="days_calculated">Vacation period goes here</p>
                                </div>
                            </div>
                        </div>

                            <div  class="form__field col-md-12 mb-2">
                                <textarea id ="comments"
                                class= form-control form-control-user
                                 name="comments" 
                                placeholder="Add your Comment here i needed"
                                 > {{vacation.comments}}</textarea>
                            </div>
                            
                            <div class="col-md-12 mt-3">
                                <input type="submit"
                                 style="width:100%"
                                  id="save_vacation_change"
                                  class="btn btn-primary btn-user"
                                   value="Save Changes">
                            </div>
                         </div>
                        </form>
                        {%else%}
                            <form class="user" method="POST"  id="add-vacation">
                                {% csrf_token%}

                                <div  class="row">
                                    <div  class="form__field col-md-3 mb-2">
                                    <!-- <label for="type_vacation">Choose Type Of Vacation </label></br> -->
                                    <select name="type_vacation" id="type_vacation" class="form-control" >
                                        {% for x,y in types%}
                                        <option value="{{x}}">{{y}}</option>
                                        {%endfor %}
                                    </select>
                                 </div>

                                 
                                 <div class="form__field col-md-3 mb-2">
                                    <div class="form-group">
                                        <div class="input-group date">
                                            <input id="start_date" placeholder="Start Date" type="text" class="form-control">
                                            <div class="input-group-addon input-group-prepend">
                                                <span class="input-group-text"><i class="fas fa-calendar"></i></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="form__field col-md-3 mb-2">
                                <div class="form-group">
                                    <div class="input-group date">
                                        <input id ="end_date" placeholder="End Date" type="text" class="form-control">
                                        <div class="input-group-addon input-group-prepend">
                                            <span class="input-group-text"><i class="fas fa-calendar"></i></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form__field col-md-3 mb-2 text-center">
                                <div class="form-group">
                                    <div class="input-group date">
                                        <p id="days_calculated">Vacation period goes here</p>
                                    </div>
                                </div>
                            </div>

                                <div  class="form__field col-md-12 mb-2">
                                    <textarea id ="comments"class= form-control form-control-user name="comments" placeholder="Add comments here..."></textarea>
                                </div>
                                
                                <div class="col-md-12 mt-3">
                                    <input type="submit" style="width:100%" id="add_vacation"class="btn btn-primary btn-user" value="Add Vacation">
                                </div>
                             </div>
                            </form>
                    {%endif%}
                        </div>
                </div>
            </div>
        </div>

    </div>
    
    <script type="text/javascript">

        $(document).on('submit','#add-vacation',function(e){
            e.preventDefault();
            $.ajax({
                url : "{%url 'add-vacation' %}", // the endpoint
                type : "POST", // http method
                data : {
                    // status : $('#status').val(),
                    type_vacation : $('#type_vacation').val(),
                    start_date : $('#start_date').val(),
                    end_date : $('#end_date').val(),
                    comments : $('#comments').val(),
                    csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
                
                
                
                }, // data sent with the post request
        
                // handle a successful response
                success : function(json) {
                    console.log(json); // log the returned json to the console
                    console.log("success"); // another sanity check
                    window.location.href = '{%url 'vacation-user' %}';
                },
                error:function(json){
                    console.log(json); // log the returned json to the console
                    console.log("error"); // another sanity check
                }
            });
        
        });
        $(document).on('submit','#update-vacation',function(e){
            e.preventDefault();
            {%if page is True %}
            var url_="{%url 'edit-vacation' vacation.id %}"
            {%else%}
            var url_=""
            {%endif%}
            $.ajax({
                url :url_ , // the endpoint
                type : "POST", // http method
                data     : {
                    // status : $('#status').val(),
                    type_vacation : $('#type_vacation').val(),
                    start_date : $('#start_date').val(),
                    end_date : $('#end_date').val(),
                    comments : $('#comments').val(),
                    csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
                
                
                
                }, // data sent with the post request
        
                // handle a successful response
                success : function(json) {
                    console.log(json); // log the returned json to the console
                    console.log("success"); // another sanity check
                    window.location.href = '{%url 'vacation-user' %}';
            },
                
                error:function(json){
                    console.log(json); // log the returned json to the console
                    console.log("error"); // another sanity check
                }
            });
        
        });

$('#start_date').dateTimePicker({
mode: 'date',
limitMin:  '{% now "Y-m-d" %}'
});

$('#end_date').dateTimePicker({
mode: 'date',
limitMin: '{% now "Y-m-d" %}'
});


// .cmp-date-time-picker detect the calender click date change bsed on moment
$(document).on('click', '.cmp-date-time-picker', function(){
var start = $('#start_date').val();
var end = $('#end_date').val();
//alert(start);
if(start.length > 0 && end.length > 0){
var a = moment(start, 'YYYY-MM-DD');
var b = moment(end, 'YYYY-MM-DD');
var diffDays = b.diff(a, 'days');
$('#days_calculated').html('Vacation time: <b>' + diffDays + '</b> ' + (diffDays > 1 ? 'days' : 'day'));
}
});

</script>



{% endblock content%}